<!DOCTYPE html>
<html>
<head>
    Naga<br>
</head>

<body>
<br>
<header>
    <h1>Covid Vaccine availability check on demand</h1>
    <h2>Vaccine availability in BBMP circle for 45+ age for next 6days from today</h2>
</header>

<button id="submit">See List</button>
<button id="clearContent">Clear</button>
<div id="showAvail"></div>
<br>
<script>
    document.getElementById("clearContent").addEventListener("click", function() {
        document.getElementById("vaccine-info").innerHTML = "";
        document.getElementById("submit").style.display = "inline";
    });

    <!-- Get status by clicking on the button -->
    document.getElementById("submit").addEventListener("click", function() {
        document.getElementById("submit").style.display = "none";
        var requestToGetStatus= new XMLHttpRequest();
        requestToGetStatus.open('GET',"https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByDistrict?district_id=294&date=06-5-2021");
        requestToGetStatus.onload = function(){
            <!--console.log(requestToGetStatus.responseText);-->
            respJsonBody=JSON.parse(requestToGetStatus.responseText);
            console.log(respJsonBody['centers']);
            renderHTML(respJsonBody['centers']);
        };
        requestToGetStatus.send();
    });

    function renderHTML(data) {
        var infoContainer=document.getElementById("vaccine-info");
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1;
        var yyyy = today.getFullYear();
        if(dd<10){
            dd='0'+dd;
        }
        if(mm<10){
            mm='0'+mm;
        }
        var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
        today = dd+'-'+mm+'-'+yyyy;
        today = today+" "+time;
        var htmlContent="";
        infoContainer.insertAdjacentHTML('beforeend',"As on <b>"+today+"</b><br>");
        infoContainer.insertAdjacentHTML('beforeend',"<i>Available date, Vaccine type, Available Slots, Center Name, Address</i><br><br>");
        for(i=0; i<data.length; i++){
            var eachCenter=data[i];
            <!--console.log("eachCenter " +eachCenter);-->
            var centerName=eachCenter['name'];
            <!--console.log("centername " + centerName);-->
            var centerAddress=eachCenter['address'];
            var centerPincode=eachCenter['pincode'];
            var centerSession=eachCenter['sessions'];
            if(centerSession.length!=0){
                for(j=0; j<centerSession.length; j++){
                    var session=centerSession[j];
                    console.log("session obj "+session);
                    var available_capacity = session['available_capacity'];
                    var minAge=session['min_age_limit'];
                    var availDate=session['date'];
                    var vaccine = session['vaccine'];
                    if(minAge==45){
                        if(available_capacity > 0){
                            htmlContent+="<p>"
                            +availDate+", "
                            +vaccine+", "
                            +available_capacity+", "
                            +centerName+", "
                            +centerAddress+", "
                            +centerPincode+", "
                            ;
                        }else{
                            console.log("Slots not available in "+ centerName);
                            <!--htmlContent+="Slots not available in "+centerName+"<br>";-->
                        }
                    }else{
                        <!--htmlContent+="Stuck in age validation";-->
                    }

                }
            }else{
                console.log("No sessions are available in "+centerName);
            }
            console.log("Rendering html finally")
            infoContainer.insertAdjacentHTML('beforeend',htmlContent);

        }
        if(htmlContent==""){
                infoContainer.insertAdjacentHTML('beforeend',"No slot available");
            }
        <!--infoContainer.insertAdjacentHTML('beforeend',htmlContent);-->
    }





</script>
<div id="vaccine-info"></div>
</body>

</html>
